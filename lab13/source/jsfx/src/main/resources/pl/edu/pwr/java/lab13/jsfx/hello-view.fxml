<?xml version="1.0" encoding="UTF-8"?>

<?language javascript?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<AnchorPane maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" onMouseMoved="initializeChoiceBox();" prefHeight="380.0" prefWidth="456.0" xmlns="http://javafx.com/javafx/16" xmlns:fx="http://javafx.com/fxml/1">
    <fx:script>
        var Template = Java.type("pl.edu.pwr.java.lab13.jsfx.template.Template");
        var HelloApplication = Java.type("pl.edu.pwr.java.lab13.jsfx.HelloApplication");
        var templates = loadTemplates();
        var choiceInitialized = false;

        function loadTemplates(){
            var reflections = new org.reflections.Reflections("templates", org.reflections.scanners.Scanners.Resources);
            var resourcePaths = reflections.getResources(java.util.regex.Pattern.compile(".*\\.xml"));
            var templateList = new java.util.ArrayList();

            var serializer = new org.simpleframework.xml.core.Persister();

            resourcePaths.forEach(function(element){
                templateList.add(
                        serializer.read(Template.class, HelloApplication.class.getResourceAsStream("/" + element))
                );
            });
            return templateList;
        }

        function initializeChoiceBox(){
            if(!choiceInitialized){
                templateChoice.getItems().addAll(templates);
                choiceInitialized = true;
            }
        }

        function buttonAction(event){
            java.lang.System.out.println("finally we get to print something.");
        }

        function clearNode(node){
            node.getChildren().clear();
        }

        function addElement(event){
            var element = new javafx.scene.layout.VBox();
            var label = new javafx.scene.control.Label("Piwo to moje paliwo");
            element.getChildren().add(label);
            inputPane.getChildren().add(element);
        }
    </fx:script>
    <children>
      <TextArea layoutX="29.0" layoutY="229.0" prefHeight="106.0" prefWidth="398.0" />
      <Button fx:id="previousButt" layoutX="195.0" layoutY="335.0" mnemonicParsing="false" onAction="clearNode(inputPane);addElement(event);" text="&lt;&lt;" />
      <Button fx:id="nextButt" layoutX="228.0" layoutY="335.0" mnemonicParsing="false" text="&gt;&gt;" />

      <ChoiceBox fx:id="templateChoice" layoutX="29.0" layoutY="30.0" prefHeight="25.0" prefWidth="398.0" />
      <TextField layoutX="29.0" layoutY="55.0" prefHeight="25.0" prefWidth="314.0" />
      <Button layoutX="342.0" layoutY="55.0" mnemonicParsing="false" text="Find data file" />
      <Label fx:id="countLabel" layoutX="329.0" layoutY="339.0" />
      <ScrollPane layoutX="29.0" layoutY="80.0" prefHeight="150.0" prefWidth="398.0">
         <content>
            <FlowPane fx:id="inputPane" prefWrapLength="0.0" rowValignment="TOP" />
         </content></ScrollPane>
   </children>
</AnchorPane>
